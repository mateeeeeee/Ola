Module ID : test.ola

declare @Assert void(i8)


declare @AssertMsg void(i8,ptr)


declare @Abstract$GetX i64(ptr)


define internal @VTable_Abstract ptr [undef,]


define external @Base$GetX i64(ptr %this) {
entry:
%0 = alloca i64
%1 = ptr add ptr %this, 8
%2 = load ptr, ptr %1
store ptr %2, ptr %0
br label exit
return:
br label exit
exit:
%3 = load i64, ptr %0
ret i64 %3
}


define external @Base$GetSumX i64(ptr %this) {
entry:
%0 = alloca i64
%1 = ptr add ptr %this, 0
%2 = load ptr, ptr %1
%3 = ptr add ptr %2, 0
%4 = load ptr, ptr %3
%5 = call ptr %this, %4
store i64 %5, ptr %0
br label exit
return:
br label exit
exit:
%6 = load i64, ptr %0
ret i64 %6
}


define internal @VTable_Base ptr [@Base$GetX,@Base$GetSumX,]


define external @Derived$GetX i64(ptr %this) {
entry:
%0 = alloca i64
%1 = ptr add ptr %this, 16
%2 = load ptr, ptr %1
store ptr %2, ptr %0
br label exit
return:
br label exit
exit:
%3 = load i64, ptr %0
ret i64 %3
}


define external @Derived$GetSumX i64(ptr %this) {
entry:
%0 = alloca i64
%1 = ptr add ptr %this, 0
%2 = load ptr, ptr %1
%3 = ptr add ptr %2, 0
%4 = load ptr, ptr %3
%5 = call ptr %this, %4
%6 = call ptr %this, @Base$GetX
%7 = add i64 %5, %6
store i64 %7, ptr %0
br label exit
return:
br label exit
exit:
%8 = load i64, ptr %0
ret i64 %8
}


define internal @VTable_Derived ptr [@Derived$GetX,@Derived$GetSumX,]


define internal @TestBase__Abstractref void(ptr %a) {
entry:
%0 = alloca ptr
store ptr %a, ptr %0
%1 = load ptr, ptr %0
%2 = ptr add ptr %1, 0
%3 = load ptr, ptr %2
%4 = ptr add ptr %3, 0
%5 = load ptr, ptr %4
%6 = call ptr %1, %5
%7 = icmp eq i64 %6, 1
call i8 %7, @Assert
br label exit
exit:
ret 
}


define internal @TestDerived__Abstractref void(ptr %a) {
entry:
%0 = alloca ptr
store ptr %a, ptr %0
%1 = load ptr, ptr %0
%2 = ptr add ptr %1, 0
%3 = load ptr, ptr %2
%4 = ptr add ptr %3, 0
%5 = load ptr, ptr %4
%6 = call ptr %1, %5
%7 = icmp eq i64 %6, 10
call i8 %7, @Assert
br label exit
exit:
ret 
}


define internal @TestDerived2__Baseref void(ptr %b) {
entry:
%0 = alloca ptr
store ptr %b, ptr %0
%1 = load ptr, ptr %0
%2 = ptr add ptr %1, 0
%3 = load ptr, ptr %2
%4 = ptr add ptr %3, 0
%5 = load ptr, ptr %4
%6 = call ptr %1, %5
%7 = icmp eq i64 %6, 10
call i8 %7, @Assert
%8 = ptr add ptr %1, 0
%9 = load ptr, ptr %8
%10 = ptr add ptr %9, 8
%11 = load ptr, ptr %10
%12 = call ptr %1, %11
%13 = icmp eq i64 %12, 11
call i8 %13, @Assert
br label exit
exit:
ret 
}


define external @main i64() {
entry:
%0 = alloca i64
%1 = alloca %Base
%2 = ptr add ptr %1, 0
store ptr @VTable_Base, ptr %2
%3 = ptr add ptr %1, 8
store 1, ptr %3
%4 = load %Base, ptr %1
call ptr %1, @TestBase__Abstractref
%5 = alloca %Derived
%6 = ptr add ptr %5, 0
store ptr @VTable_Derived, ptr %6
%7 = ptr add ptr %5, 8
store 1, ptr %7
%8 = ptr add ptr %5, 16
store 10, ptr %8
%9 = load %Derived, ptr %5
call ptr %5, @TestDerived__Abstractref
%10 = load %Derived, ptr %5
call ptr %5, @TestDerived2__Baseref
store 0, ptr %0
br label exit
return:
br label exit
exit:
%11 = load i64, ptr %0
ret i64 %11
}

